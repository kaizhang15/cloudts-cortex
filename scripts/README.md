## Reproducing Evaluation Results

In this directory, we provide scripts for reproducing main results in our paper. Before proceeding with the experiments, ensure you have successfully built the project.

To run the Python scripts that generate the graphs, please install the necessary libraries:

```bash
pip3 install matplotlib pandas numpy seaborn
```



### Production Environment

For the evaluation setup and cortex configuration, please refer to [here](https://github.com/kaizhang15/cloudts-cortex/blob/main/README.md#production-environment).

After deploy the systems, you can execute cortex range queries for metrics (`cpu` and `memory`) for the latest 5-minute data with the following example:

```bash
# cpu
curl -X GET   "http://localhost:9009/api/prom/api/v1/query_range?query=node_load1&start=2023-01-01T00:00:00Z&end=2023-01-01T00:05:00Z&step=15s"
# memory
curl -X GET   "http://localhost:9009/api/prom/api/v1/query_range?query=node_memory_Active_bytes&start=2023-01-01T00:00:00Z&end=2023-01-01T00:05:00Z&step=15s"
```



#### Generating Figure 10

To generate data for Figure 10, please run each query 240 times for both CloudTS and Cortex and collected the total execution durations as follows:

```bash
cd ${Your_project_directory}/scripts/figure10

# Execute the following two commands respectively
# cpu
curl -X GET   "http://localhost:9009/api/prom/api/v1/query_range?query=node_load1&start=2023-01-01T00:00:00Z&end=2023-01-01T00:05:00Z&step=15s" -w "@time.txt"

# memory
curl -X GET   "http://localhost:9009/api/prom/api/v1/query_range?query=node_memory_Active_bytes&start=2023-01-01T00:00:00Z&end=2023-01-01T00:05:00Z&step=15s" -w "@time.txt"

#Example output
{"status":"success","data":{"resultType":"matrix","result":[{"metric":{"__name__":"node_memory_Active_bytes","instance":......
                     ----------
  time_starttransfer:  xxxxx s
          time_total:  xxxxx s
```

The output shows the total time utilized. Please insert `time_total` in to `cloudts-production-latency.csv` in `figure10` directory.

```
# Example of cloudts-production-latency.csv
time,CloudTS_cpu,Cortex_cpu,CloudTS_mem,Cortex_mem
1,0.00267,0.00246,0.00262,0.00323
2,0.00269,0.00418,0.00259,0.00406
3,0.00279,0.00275,0.00309,0.00531
4,0.00256,0.00378,0.00253,0.00432
......
```



After collect all the data, please run the following command to create and save `figure10.pdf` in `figure10` directory:

```bash
python3 figure10.py
```

  

### Synthetic Workload

For the evaluation setup and cortex configuration, please refer to [here](https://github.com/kaizhang15/cloudts-cortex/blob/main/README.md#synthetic-workload).

To generate data for Table 3 and Figure 10, please manually modify the queries generated by TSBS in to following format:

```bash
curl -X GET   "http://localhost:9009/api/prom/api/v1/xxxxx -w "@time.txt"

#Example output
{"status":"success","data":......
                     ----------
        time_connect:  aaaaaa s
    time_pretransfer:  bbbbbb s
  time_starttransfer:  cccccc s
          time_total:  dddddd s
                     ----------
      query_duration:  dddddd s - aaaaaa s
```



#### Generating Table 3

The output of each query contains `query_duration`, which represent the query duration for the server to handle and transfer data. Please collect all the results and calculate the average values for different query patterns.



#### Generating Figure 12

The output of each query contains `time_starttransfer`, which represents the latency for the client to receive the first data packet from the server. Please insert `time_starttransfer` in to `cloudts-first-arrive.csv` in `figure12` directory.

```
# Example of cloudts-first-arrive.csv
time,Cortex,CloudTS
1,0.15092,0.11254
2,0.16043,0.1399
3,0.16336,0.10125
4,0.15162,0.11409
......
```



After collect all the data, please run the following command to create and save `figure12.pdf` in `figure12` directory:

```bash
cd ${Your_project_directory}/scripts/figure10
python3 figure12.py
```







